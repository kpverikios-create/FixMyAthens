<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FixMyAthens â€” Î’ÏÎµÏ‚ Î¼Î¬ÏƒÏ„Î¿ÏÎ± Ï„ÏÏÎ±</title>

  <meta name="theme-color" content="#0f172a"/>
  <link rel="manifest" href="/manifest.json">

  <style>
    :root{
      --bg:#0f172a;
      --card:#121826;
      --accent:#38bdf8;
      --text:#f8fafc;
      --dim:#94a3b8;
      --radius:14px;
      --font:-apple-system,BlinkMacSystemFont,"Inter",Roboto,Arial,sans-serif;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:var(--font);
      -webkit-font-smoothing:antialiased;
    }
    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:24px;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      margin-bottom:16px;
      border:1px solid rgba(255,255,255,0.03);
      box-shadow:0 30px 80px rgba(0,0,0,0.6);
    }
    header{
      display:flex;
      align-items:center;
      gap:12px
    }
    .logoRow{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .appIcon{
      width:40px;
      height:40px;
      border-radius:10px;
      background:#0f172a;
      border:1px solid rgba(255,255,255,0.08);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:0.6rem;
      font-weight:600;
      color:var(--accent);
      line-height:1.2;
      text-align:center;
      font-family:var(--font);
    }
    .brand{
      font-weight:700;
      font-size:1.15rem
    }
    .tag{
      color:var(--dim);
      font-size:0.9rem
    }
    .admin-bar{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
      margin-left:auto;
    }
    .pill{
      background:rgba(255,255,255,0.03);
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.03);
      font-size:0.8rem;
      color:var(--dim);
      white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
      gap:12px;
      margin-top:12px
    }
    .choice{
      background:rgba(255,255,255,0.02);
      padding:14px;
      border-radius:10px;
      text-align:center;
      cursor:pointer;
      border:1px solid rgba(255,255,255,0.06);
      min-height:110px;
      display:flex;
      flex-direction:column;
      justify-content:center;
    }
    .choice:hover{box-shadow:0 16px 40px rgba(0,0,0,0.7)}
    .choiceIcon{
      font-size:1.5rem;
      margin-bottom:8px;
    }

    .btn{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:none;
      background:var(--accent);
      color:#061023;
      font-weight:700;
      font-size:1rem;
      cursor:pointer
    }
    .btn.secondary{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:var(--text)
    }

    label{
      display:block;
      font-weight:600;
      margin-bottom:6px;
      color:var(--text);
      font-size:0.9rem;
    }
    input,select,textarea{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      background:#0b1118;
      color:var(--text);
      margin-bottom:12px;
      font-size:0.95rem
    }

    .list-item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      margin-bottom:10px;
      background:rgba(255,255,255,0.02);
    }
    .meta{
      color:var(--dim);
      font-size:0.85rem;
      line-height:1.4;
    }
    .actions{
      display:flex;
      gap:8px;
      flex-shrink:0;
    }
    .small{
      padding:8px 10px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:700;
      font-size:0.8rem;
      line-height:1.2;
    }
    .call{
      background:#10b981;
      color:#062017
    }
    .wa{
      background:#25D366;
      color:#062017
    }

    footer{
      color:var(--dim);
      font-size:0.8rem;
      text-align:center;
      margin-top:18px
    }
    .hidden{display:none}

    .content{
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    @media(min-width:800px){
      .content{
        flex-direction:row;
      }
      .left{
        flex:1;
      }
      .right{
        width:380px;
        flex-shrink:0;
      }
    }

    hr{
      border:none;
      height:1px;
      background:rgba(255,255,255,0.05);
      margin:12px 0;
    }

    code{
      background:rgba(0,0,0,0.4);
      padding:2px 4px;
      border-radius:4px;
      font-size:0.8rem;
      color:var(--accent);
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- HEADER -->
    <div class="card">
      <header>
        <div class="logoRow">
          <!-- Î¤Î¿ "Î»Î¿Î³ÏŒÏ„Ï…Ï€Î¿" ÏƒÎ¿Ï… -->
          <div class="appIcon" title="FixMyAthens">
            ğŸ”§<br>FMA
          </div>
          <div>
            <div class="brand">FixMyAthens</div>
            <div class="tag">Î’ÏÎµÏ‚ Î¼Î¬ÏƒÏ„Î¿ÏÎ± ÏƒÏ„Î·Î½ Î‘Î¸Î®Î½Î± â€” Î“ÏÎ®Î³Î¿ÏÎ± &amp; Î‘Ï€Î»Î¬</div>
          </div>
        </div>

        <div id="adminBar" class="admin-bar hidden">
          <div class="pill">Pay-per-lead: 5â‚¬ / Î´Î¿Ï…Î»ÎµÎ¹Î¬</div>
          <button class="btn secondary" id="exportCsvBtn" style="width:auto;padding:8px 12px;font-size:0.8rem;font-weight:600;">
            Î›Î®ÏˆÎ· Leads (CSV)
          </button>
        </div>
      </header>
    </div>

    <div class="content">

      <!-- LEFT COLUMN: main flow -->
      <div class="left">

        <!-- SCREEN 1: select service -->
        <div id="homeCard" class="card">
          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Î¤Î¹ Î¼Î¬ÏƒÏ„Î¿ÏÎ± Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÎ±Î¹;
          </div>

          <div class="grid" id="serviceGrid">
            <!-- Î¸Î± Î³ÎµÎ¼Î¯ÏƒÎµÎ¹ Î¼Îµ ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ -->
          </div>

          <div style="margin-top:16px">
            <button class="btn" id="toFormBtn">Î£Ï…Î½Î­Ï‡Î¹ÏƒÎµ</button>
          </div>
        </div>

        <!-- SCREEN 2: problem form -->
        <div id="formCard" class="card hidden">
          <div style="font-weight:700;margin-bottom:12px;font-size:1rem;">
            Î ÎµÏ‚ Î¼Î±Ï‚ Ï„Î¿ Ï€ÏÏŒÎ²Î»Î·Î¼Î¬ ÏƒÎ¿Ï…
          </div>

          <div>
            <label>Î•Î¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±</label>
            <select id="serviceSelect"></select>

            <label>Î ÎµÏÎ¹Î¿Ï‡Î® / Î“ÎµÎ¹Ï„Î¿Î½Î¹Î¬</label>
            <input id="areaInput" placeholder="Ï€.Ï‡. Î Î±Î³ÎºÏÎ¬Ï„Î¹" />

            <label>Î¤Î¹ Î­Ï‡ÎµÎ¹ ÏƒÏ…Î¼Î²ÎµÎ¯;</label>
            <textarea id="descInput" rows="3" placeholder="Î .Ï‡. Ï„ÏÎ­Ï‡ÎµÎ¹ Î½ÎµÏÏŒ Î±Ï€ÏŒ Ï„Î¿Î½ Î½Î¹Ï€Ï„Î®ÏÎ±"></textarea>

            <label>Î ÏŒÏ„Îµ Ï„Î¿ Î¸Î­Î»ÎµÎ¹Ï‚;</label>
            <select id="urgencySelect">
              <option>Î£Î®Î¼ÎµÏÎ± (Î­ÎºÏ„Î±ÎºÏ„Î¿)</option>
              <option>Î‘ÏÏÎ¹Î¿</option>
              <option>ÎŒÏ€Î¿Ï„Îµ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ</option>
            </select>

            <label>Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚</label>
            <input id="phoneInput" placeholder="69..." />

            <div style="font-size:0.7rem;line-height:1.4;color:var(--dim);margin-top:-6px;margin-bottom:12px;">
              Î£Ï…Î¼Ï†Ï‰Î½Ï Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Î¼Î¿Ï… Î½Î± ÏƒÏ„Î±Î»Î¿ÏÎ½ ÏƒÏ„Î¿Î½ Ï„ÎµÏ‡Î½Î¹ÎºÏŒ Î³Î¹Î± Î½Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÎµÎ¹ Î¼Î±Î¶Î¯ Î¼Î¿Ï….
            </div>

            <div style="display:flex;gap:8px;margin-top:6px;flex-wrap:wrap;">
              <button class="btn" id="findBtn" style="flex:1;">Î’Î¡Î•Î£ ÎœÎ‘Î£Î¤ÎŸÎ¡Î‘ Î¤Î©Î¡Î‘</button>
              <button class="btn secondary" id="backHomeBtn" style="flex:1;">â† Î Î¯ÏƒÏ‰</button>
            </div>
          </div>
        </div>

        <!-- SCREEN 3: results -->
        <div id="resultsCard" class="card hidden">
          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            ÎœÎ¬ÏƒÏ„Î¿ÏÎµÏ‚ Ï€Î¿Ï… Ï„Î±Î¹ÏÎ¹Î¬Î¶Î¿Ï…Î½
          </div>

          <div id="mastersList">
            <!-- Î´Ï…Î½Î±Î¼Î¹ÎºÎ¬ -->
          </div>

          <div id="noMasters" class="meta hidden" style="margin-top:12px;">
            Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î¼Î¬ÏƒÏ„Î¿ÏÎµÏ‚ Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÎ¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±/Ï€ÎµÏÎ¹Î¿Ï‡Î®.<br>
            Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¬Î»Î»Î· Ï€ÎµÏÎ¹Î¿Ï‡Î® Î® Î¬Î»Î»Î· ÎµÎ¹Î´Î¹ÎºÏŒÏ„Î·Ï„Î±.
          </div>

          <div style="margin-top:16px">
            <button class="btn secondary" id="backToFormBtn">â† Î Î¯ÏƒÏ‰</button>
          </div>
        </div>

        <!-- SCREEN 4: success -->
        <div id="successCard" class="card hidden">
          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Î¤Î¿ Î±Î¯Ï„Î·Î¼Î¬ ÏƒÎ¿Ï… ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ! âœ…
          </div>
          <div class="meta">
            ÎŸ Ï„ÎµÏ‡Î½Î¹ÎºÏŒÏ‚ Î¸Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÎµÎ¹ Î¼Î±Î¶Î¯ ÏƒÎ¿Ï….
            Î ÎµÏ‚ ÏŒÏ„Î¹ Ï„Î¿Î½ Î²ÏÎ®ÎºÎµÏ‚ Î±Ï€ÏŒ Ï„Î¿ FixMyAthens.
          </div>

          <div style="margin-top:16px">
            <button class="btn" id="homeFromSuccess">Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ®</button>
          </div>
        </div>

      </div>

      <!-- RIGHT COLUMN: info -->
      <div class="right">

        <div class="card">
          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Î ÏÏ‚ Î´Î¿Ï…Î»ÎµÏÎµÎ¹
          </div>
          <div class="meta">
            1. Î”Î¹Î±Î»Î­Î³ÎµÎ¹Ï‚ Ï„Î¹ Î¼Î¬ÏƒÏ„Î¿ÏÎ± Î¸ÎµÏ‚.<br>
            2. Î“ÏÎ¬Ï†ÎµÎ¹Ï‚ Ï„Î¿ Ï€ÏÏŒÎ²Î»Î·Î¼Î± ÎºÎ±Î¹ Ï„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î® ÏƒÎ¿Ï….<br>
            3. Î’Î»Î­Ï€ÎµÎ¹Ï‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿Ï…Ï‚ Î¼Î¬ÏƒÏ„Î¿ÏÎµÏ‚.<br>
            4. Î¤Î¿Ï…Ï‚ ÎºÎ±Î»ÎµÎ¯Ï‚ Î® Ï„Î¿Ï…Ï‚ ÏƒÏ„Î­Î»Î½ÎµÎ¹Ï‚ WhatsApp Ï„ÏÏÎ±.
          </div>

          <hr>

          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Î ÏŒÏƒÎ¿ ÎºÎ¿ÏƒÏ„Î¯Î¶ÎµÎ¹
          </div>
          <div class="meta">
            Î“Î¹Î± ÏƒÎ­Î½Î±: 0â‚¬.<br>
            ÎŸÎ¹ Î¼Î¬ÏƒÏ„Î¿ÏÎµÏ‚ Ï€Î»Î·ÏÏÎ½Î¿Ï…Î½ 5â‚¬ Î±Î½Î¬ Î´Î¿Ï…Î»ÎµÎ¹Î¬ (pay-per-lead).
          </div>

          <hr>

          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Î ÏÏ‚ Ï€ÏÎ¿ÏƒÎ¸Î­Ï„ÎµÎ¹Ï‚ Î¼Î¬ÏƒÏ„Î¿ÏÎµÏ‚
          </div>
          <div class="meta">
            Î†Î½Î¿Î¹Î¾Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ <code>index.html</code> ÎºÎ±Î¹ Î²ÏÎµÏ‚ Ï„Î¿ <code>const MASTORES = [ ]</code> ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚.<br>
            Î ÏÏŒÏƒÎ¸ÎµÏƒÎµ:
            <code>{ id, name, type, areas:[...], phone, whatsapp, availability }</code>
          </div>
        </div>

        <div class="card">
          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Admin mode
          </div>
          <div class="meta">
            Î†Î½Î¿Î¹Î¾Îµ Ï„Î¿ site ÏƒÎ¿Ï… Î¼Îµ <code>?admin=1</code> ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ Ï„Î¿Ï… URL.<br><br>
            Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:<br>
            <code>https://fixmyathens.vercel.app/?admin=1</code><br><br>
            Î˜Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ ÎºÎ¿Ï…Î¼Ï€Î¯ "Î›Î®ÏˆÎ· Leads (CSV)" Î³Î¹Î± Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÎ¹Ï‚ ÏŒÎ»Î± Ï„Î± leads.
          </div>
        </div>

      </div>
    </div>

    <footer>
      FixMyAthens Â© 2025 Â· Athens<br>
      <div style="margin-top:6px;color:var(--dim);font-size:0.7rem;line-height:1.4;">
        ÎœÎµ Ï„Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î·Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ ÏƒÏ…Î¼Ï†Ï‰Î½ÎµÎ¯Ï‚ ÏŒÏ„Î¹ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÎ¿Ï… Î¸Î± ÏƒÏ„Î±Î»Î¿ÏÎ½
        ÏƒÏ„Î¿Î½ Ï„ÎµÏ‡Î½Î¹ÎºÏŒ Î³Î¹Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î±.
      </div>
    </footer>

  </div>

  <!-- ====================== LOGIC ====================== -->
  <script>
  // ---------- Î¡Î¥Î˜ÎœÎ™Î£Î•Î™Î£ ----------
  const SERVICES = [
    { label:"Î¥Î´ÏÎ±Ï…Î»Î¹ÎºÏŒÏ‚",        icon:"ğŸš°" },
    { label:"Î—Î»ÎµÎºÏ„ÏÎ¿Î»ÏŒÎ³Î¿Ï‚",      icon:"ğŸ’¡" },
    { label:"ÎšÎ»ÎµÎ¹Î´Î±ÏÎ¬Ï‚",         icon:"ğŸ”‘" },
    { label:"Î¨Ï…ÎºÏ„Î¹ÎºÏŒÏ‚ (A/C)",    icon:"â„ï¸" },
    { label:"Î“ÎµÎ½Î¹ÎºÏŒÏ‚ Î¼Î¬ÏƒÏ„Î¿ÏÎ±Ï‚",  icon:"ğŸ› ï¸" },
    { label:"Î†Î»Î»Î¿",              icon:"ğŸ”§" }
  ];

  // ---------- ÎœÎ‘Î£Î¤ÎŸÎ¡Î•Î£ ----------
  // Î•Î£Î¥ Î˜Î‘ Î¤ÎŸÎ¥Î£ Î Î¡ÎŸÎ£Î˜Î•Î£Î•Î™Î£ Î•Î”Î©. Î‘ÏÏ‡Î¹ÎºÎ¬ Î¬Î´ÎµÎ¹Î¿, ÏŒÏ€Ï‰Ï‚ Î¶Î®Ï„Î·ÏƒÎµÏ‚.
  const MASTORES = [
    // Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± format (ÎœÎ—Î Ï„Î¿ Î±Ï†Î®ÏƒÎµÎ¹Ï‚ ÏŒÏ„Î±Î½ Ï€Î±Ï‚ live Î¼Îµ Î¾Î­Î½Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î±):
    // {
    //   id: "m001",
    //   name: "ÎŒÎ½Î¿Î¼Î± ÎœÎ¬ÏƒÏ„Î¿ÏÎ±",
    //   type: "Î¥Î´ÏÎ±Ï…Î»Î¹ÎºÏŒÏ‚",
    //   areas: ["Î Î±Î³ÎºÏÎ¬Ï„Î¹","ÎÎ­Î± Î£Î¼ÏÏÎ½Î·"],
    //   phone: "6900000000",
    //   whatsapp: "6900000000",
    //   availability: "Î£Î®Î¼ÎµÏÎ±"
    // }
  ];

  // ---------- DOM refs ----------
  const homeCard = document.getElementById('homeCard');
  const formCard = document.getElementById('formCard');
  const resultsCard = document.getElementById('resultsCard');
  const successCard = document.getElementById('successCard');

  const serviceGrid = document.getElementById('serviceGrid');
  const toFormBtn = document.getElementById('toFormBtn');

  const serviceSelect = document.getElementById('serviceSelect');
  const areaInput = document.getElementById('areaInput');
  const descInput = document.getElementById('descInput');
  const urgencySelect = document.getElementById('urgencySelect');
  const phoneInput = document.getElementById('phoneInput');

  const findBtn = document.getElementById('findBtn');
  const backHomeBtn = document.getElementById('backHomeBtn');
  const backToFormBtn = document.getElementById('backToFormBtn');
  const homeFromSuccess = document.getElementById('homeFromSuccess');

  const mastersList = document.getElementById('mastersList');
  const noMasters = document.getElementById('noMasters');

  const adminBar = document.getElementById('adminBar');
  const exportCsvBtn = document.getElementById('exportCsvBtn');

  // ---------- INIT UI ----------
  function initUI(){
    // 1. Î“Î­Î¼Î¹ÏƒÎµ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ (Home grid)
    SERVICES.forEach(s=>{
      const el = document.createElement('div');
      el.className='choice';
      el.innerHTML = `
        <div class="choiceIcon">${s.icon}</div>
        <div style="font-weight:700;font-size:0.95rem;">${s.label}</div>
        <div class="meta" style="margin-top:6px;font-size:0.8rem;">
          Î•Ï€Î¯Î»ÎµÎ¾Îµ & ÏƒÏ…Î½Î­Ï‡Î¹ÏƒÎµ
        </div>`;
      el.onclick = ()=>{
        serviceSelect.value = s.label;
        goToForm();
      };
      serviceGrid.appendChild(el);
    });

    // 2. Î“Î­Î¼Î¹ÏƒÎµ select ÏƒÏ„Î· Ï†ÏŒÏÎ¼Î±
    SERVICES.forEach(s=>{
      const o = document.createElement('option');
      o.value = s.label;
      o.textContent = s.label;
      serviceSelect.appendChild(o);
    });

    // 3. ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ ÏÎ¿Î®Ï‚
    toFormBtn.onclick = goToForm;
    backHomeBtn.onclick = goHomeFromForm;
    backToFormBtn.onclick = ()=>{ resultsCard.classList.add('hidden'); formCard.classList.remove('hidden'); };
    homeFromSuccess.onclick = ()=>{ successCard.classList.add('hidden'); homeCard.classList.remove('hidden'); };

    findBtn.onclick = onFind;

    // 4. Admin mode (leads CSV)
    const params = new URLSearchParams(location.search);
    if(params.get('admin')==='1'){
      adminBar.classList.remove('hidden');
    }
    exportCsvBtn.onclick = exportLeadsCsv;
  }

  function goToForm(){
    homeCard.classList.add('hidden');
    resultsCard.classList.add('hidden');
    successCard.classList.add('hidden');
    formCard.classList.remove('hidden');
  }

  function goHomeFromForm(){
    formCard.classList.add('hidden');
    resultsCard.classList.add('hidden');
    successCard.classList.add('hidden');
    homeCard.classList.remove('hidden');
  }

  // ---------- FIND MASTERS ----------
  function onFind(e){
    e.preventDefault?.();

    const service = serviceSelect.value.trim();
    const area = areaInput.value.trim();
    const desc = descInput.value.trim();
    const urgency = urgencySelect.value.trim();
    const phone = phoneInput.value.trim();

    if(!service || !area || !desc || !phone){
      alert("Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ ÏŒÎ»Î± Ï„Î± Ï€ÎµÎ´Î¯Î±.");
      return;
    }

    const matches = MASTORES.filter(m=>{
      const typeOk = (
        m.type === service ||
        (service==="Î†Î»Î»Î¿" && m.type==="Î“ÎµÎ½Î¹ÎºÏŒÏ‚ Î¼Î¬ÏƒÏ„Î¿ÏÎ±Ï‚")
      );
      const areaOk = m.areas.some(a => a.trim().toLowerCase() === area.toLowerCase());
      return typeOk && areaOk;
    });

    renderMasters(matches, {service,area,desc,urgency,phone});
  }

  // ---------- RENDER RESULTS ----------
  function renderMasters(list, requestData){
    formCard.classList.add('hidden');
    resultsCard.classList.remove('hidden');
    mastersList.innerHTML = '';

    if(!list.length){
      noMasters.classList.remove('hidden');
      return;
    }
    noMasters.classList.add('hidden');

    list.forEach(m => {
      const row = document.createElement('div');
      row.className = 'list-item';

      const left = document.createElement('div');
      left.innerHTML = `
        <div style="font-weight:700;font-size:0.95rem;">${m.name}</div>
        <div class="meta">${m.type} Â· ${m.availability || "Î”Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±;"}</div>
        <div class="meta" style="margin-top:6px;font-size:0.75rem;">
          ÎšÎ±Î»ÏÏ€Ï„ÎµÎ¹: ${m.areas.join(', ')}
        </div>
      `;

      const right = document.createElement('div');
      right.className='actions';

      const callBtn = document.createElement('button');
      callBtn.className='small call';
      callBtn.textContent='ÎšÎ‘Î›Î•Î£Î•';
      callBtn.onclick = () => {
        recordLead(m, requestData, 'call');
        window.location.href = `tel:${m.phone}`;
      };

      const waBtn = document.createElement('button');
      waBtn.className='small wa';
      waBtn.textContent='WHATSAPP';
      waBtn.onclick = () => {
        recordLead(m, requestData, 'whatsapp');
        const msg =
`Î“ÎµÎ¹Î± ÏƒÎ¿Ï…, ÏƒÎµ Î²ÏÎ®ÎºÎ± Î±Ï€ÏŒ Ï„Î¿ FixMyAthens.
ÎˆÏ‡Ï‰ Ï„Î¿ ÎµÎ¾Î®Ï‚ Î¸Î­Î¼Î±: ${requestData.desc}
Î ÎµÏÎ¹Î¿Ï‡Î®: ${requestData.area}
Î¤Î·Î»: ${requestData.phone}`;
        const encoded = encodeURIComponent(msg);
        window.open(
          `https://wa.me/30${m.whatsapp}?text=${encoded}`,
          '_blank'
        );
      };

      right.appendChild(callBtn);
      right.appendChild(waBtn);

      row.appendChild(left);
      row.appendChild(right);

      mastersList.appendChild(row);
    });
  }

  // ---------- LEADS STORAGE (LOCAL) ----------
  function getLeads(){
    try{
      const raw = localStorage.getItem('fixmyathens_leads');
      return raw ? JSON.parse(raw) : [];
    }catch(e){
      return [];
    }
  }
  function saveLeads(arr){
    localStorage.setItem('fixmyathens_leads', JSON.stringify(arr));
  }
  function recordLead(master, request, channel){
    const leads = getLeads();
    const lead = {
      id: Date.now().toString(),
      timestamp: new Date().toISOString(),
      masterId: master.id || null,
      masterName: master.name || null,
      masterPhone: master.phone || null,
      channel,
      requestService: request.service,
      requestArea: request.area,
      requestDesc: request.desc,
      requestUrgency: request.urgency,
      requestPhone: request.phone
    };
    leads.push(lead);
    saveLeads(leads);

    resultsCard.classList.add('hidden');
    successCard.classList.remove('hidden');
  }

  // ---------- EXPORT CSV (ADMIN) ----------
  function exportLeadsCsv(){
    const leads = getLeads();
    if(!leads.length){
      alert("Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ leads.");
      return;
    }

    const headers = [
      "id","timestamp","masterId","masterName","masterPhone",
      "channel","requestService","requestArea","requestDesc",
      "requestUrgency","requestPhone"
    ];

    const rows = leads.map(l =>
      headers.map(h=> JSON.stringify(l[h] ?? "") ).join(',')
    );

    const csv = [headers.join(',')].concat(rows).join('\r\n');
    const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = `fixmyathens_leads_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.csv`;
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  // ---------- INIT + PWA REGISTER ----------
  initUI();

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
      .catch(err => console.log('SW registration failed', err));
  }
  </script>
</body>
</html>
