<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FixMyAthens — Βρες μάστορα τώρα</title>

  <meta name="theme-color" content="#0f172a"/>
  <link rel="manifest" href="/manifest.json">

  <style>
    :root{
      --bg:#0f172a;
      --card:#121826;
      --accent:#38bdf8;
      --text:#f8fafc;
      --dim:#94a3b8;
      --radius:14px;
      --font:-apple-system,BlinkMacSystemFont,"Inter",Roboto,Arial,sans-serif;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:var(--font);
      -webkit-font-smoothing:antialiased;
    }
    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:24px;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      margin-bottom:16px;
      border:1px solid rgba(255,255,255,0.03);
      box-shadow:0 30px 80px rgba(0,0,0,0.6);
    }
    header{
      display:flex;
      align-items:center;
      gap:12px
    }
    .logoRow{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .appIcon{
      width:40px;
      height:40px;
      border-radius:10px;
      background:#0f172a;
      border:1px solid rgba(255,255,255,0.08);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:0.6rem;
      font-weight:600;
      color:var(--accent);
      line-height:1.2;
      text-align:center;
      font-family:var(--font);
    }
    .brand{
      font-weight:700;
      font-size:1.15rem
    }
    .tag{
      color:var(--dim);
      font-size:0.9rem
    }
    .admin-bar{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
      margin-left:auto;
    }
    .pill{
      background:rgba(255,255,255,0.03);
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.03);
      font-size:0.8rem;
      color:var(--dim);
      white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
      gap:12px;
      margin-top:12px
    }
    .choice{
      background:rgba(255,255,255,0.02);
      padding:14px;
      border-radius:10px;
      text-align:center;
      cursor:pointer;
      border:1px solid rgba(255,255,255,0.06);
      min-height:110px;
      display:flex;
      flex-direction:column;
      justify-content:center;
    }
    .choice:hover{box-shadow:0 16px 40px rgba(0,0,0,0.7)}
    .choiceIcon{
      font-size:1.5rem;
      margin-bottom:8px;
    }

    .btn{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:none;
      background:var(--accent);
      color:#061023;
      font-weight:700;
      font-size:1rem;
      cursor:pointer
    }
    .btn.secondary{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:var(--text)
    }

    label{
      display:block;
      font-weight:600;
      margin-bottom:6px;
      color:var(--text);
      font-size:0.9rem;
    }
    input,select,textarea{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      background:#0b1118;
      color:var(--text);
      margin-bottom:12px;
      font-size:0.95rem
    }

    .list-item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      margin-bottom:10px;
      background:rgba(255,255,255,0.02);
    }
    .meta{
      color:var(--dim);
      font-size:0.85rem;
      line-height:1.4;
    }
    .actions{
      display:flex;
      gap:8px;
      flex-shrink:0;
    }
    .small{
      padding:8px 10px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:700;
      font-size:0.8rem;
      line-height:1.2;
    }
    .call{
      background:#10b981;
      color:#062017
    }
    .wa{
      background:#25D366;
      color:#062017
    }

    footer{
      color:var(--dim);
      font-size:0.8rem;
      text-align:center;
      margin-top:18px
    }
    .hidden{display:none}

    .content{
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    @media(min-width:800px){
      .content{
        flex-direction:row;
      }
      .left{
        flex:1;
      }
      .right{
        width:380px;
        flex-shrink:0;
      }
    }

    hr{
      border:none;
      height:1px;
      background:rgba(255,255,255,0.05);
      margin:12px 0;
    }

    code{
      background:rgba(0,0,0,0.4);
      padding:2px 4px;
      border-radius:4px;
      font-size:0.8rem;
      color:var(--accent);
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- HEADER -->
    <div class="card">
      <header>
        <div class="logoRow">
          <!-- Το "λογότυπο" σου -->
          <div class="appIcon" title="FixMyAthens">
            🔧<br>FMA
          </div>
          <div>
            <div class="brand">FixMyAthens</div>
            <div class="tag">Βρες μάστορα στην Αθήνα — Γρήγορα &amp; Απλά</div>
          </div>
        </div>

        <div id="adminBar" class="admin-bar hidden">
          <div class="pill">Pay-per-lead: 5€ / δουλειά</div>
          <button class="btn secondary" id="exportCsvBtn" style="width:auto;padding:8px 12px;font-size:0.8rem;font-weight:600;">
            Λήψη Leads (CSV)
          </button>
        </div>
      </header>
    </div>

    <div class="content">

      <!-- LEFT COLUMN: main flow -->
      <div class="left">

        <!-- SCREEN 1: select service -->
        <div id="homeCard" class="card">
          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Τι μάστορα χρειάζεσαι;
          </div>

          <div class="grid" id="serviceGrid">
            <!-- θα γεμίσει με κουμπιά -->
          </div>

          <div style="margin-top:16px">
            <button class="btn" id="toFormBtn">Συνέχισε</button>
          </div>
        </div>

        <!-- SCREEN 2: problem form -->
        <div id="formCard" class="card hidden">
          <div style="font-weight:700;margin-bottom:12px;font-size:1rem;">
            Πες μας το πρόβλημά σου
          </div>

          <div>
            <label>Ειδικότητα</label>
            <select id="serviceSelect"></select>

            <label>Περιοχή / Γειτονιά</label>
            <input id="areaInput" placeholder="π.χ. Παγκράτι" />

            <label>Τι έχει συμβεί;</label>
            <textarea id="descInput" rows="3" placeholder="Π.χ. τρέχει νερό από τον νιπτήρα"></textarea>

            <label>Πότε το θέλεις;</label>
            <select id="urgencySelect">
              <option>Σήμερα (έκτακτο)</option>
              <option>Αύριο</option>
              <option>Όποτε μπορείτε</option>
            </select>

            <label>Τηλέφωνο επικοινωνίας</label>
            <input id="phoneInput" placeholder="69..." />

            <div style="font-size:0.7rem;line-height:1.4;color:var(--dim);margin-top:-6px;margin-bottom:12px;">
              Συμφωνώ τα στοιχεία μου να σταλούν στον τεχνικό για να επικοινωνήσει μαζί μου.
            </div>

            <div style="display:flex;gap:8px;margin-top:6px;flex-wrap:wrap;">
              <button class="btn" id="findBtn" style="flex:1;">ΒΡΕΣ ΜΑΣΤΟΡΑ ΤΩΡΑ</button>
              <button class="btn secondary" id="backHomeBtn" style="flex:1;">← Πίσω</button>
            </div>
          </div>
        </div>

        <!-- SCREEN 3: results -->
        <div id="resultsCard" class="card hidden">
          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Μάστορες που ταιριάζουν
          </div>

          <div id="mastersList">
            <!-- δυναμικά -->
          </div>

          <div id="noMasters" class="meta hidden" style="margin-top:12px;">
            Δεν βρέθηκαν μάστορες για αυτή την ειδικότητα/περιοχή.<br>
            Δοκίμασε άλλη περιοχή ή άλλη ειδικότητα.
          </div>

          <div style="margin-top:16px">
            <button class="btn secondary" id="backToFormBtn">← Πίσω</button>
          </div>
        </div>

        <!-- SCREEN 4: success -->
        <div id="successCard" class="card hidden">
          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Το αίτημά σου στάλθηκε! ✅
          </div>
          <div class="meta">
            Ο τεχνικός θα επικοινωνήσει μαζί σου.
            Πες ότι τον βρήκες από το FixMyAthens.
          </div>

          <div style="margin-top:16px">
            <button class="btn" id="homeFromSuccess">Επιστροφή στην αρχική</button>
          </div>
        </div>

      </div>

      <!-- RIGHT COLUMN: info -->
      <div class="right">

        <div class="card">
          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Πώς δουλεύει
          </div>
          <div class="meta">
            1. Διαλέγεις τι μάστορα θες.<br>
            2. Γράφεις το πρόβλημα και την περιοχή σου.<br>
            3. Βλέπεις διαθέσιμους μάστορες.<br>
            4. Τους καλείς ή τους στέλνεις WhatsApp τώρα.
          </div>

          <hr>

          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Πόσο κοστίζει
          </div>
          <div class="meta">
            Για σένα: 0€.<br>
            Οι μάστορες πληρώνουν 5€ ανά δουλειά (pay-per-lead).
          </div>

          <hr>

          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Πώς προσθέτεις μάστορες
          </div>
          <div class="meta">
            Άνοιξε το αρχείο <code>index.html</code> και βρες το <code>const MASTORES = [ ]</code> στο τέλος.<br>
            Πρόσθεσε:
            <code>{ id, name, type, areas:[...], phone, whatsapp, availability }</code>
          </div>
        </div>

        <div class="card">
          <div style="font-weight:700;margin-bottom:6px;font-size:1rem;">
            Admin mode
          </div>
          <div class="meta">
            Άνοιξε το site σου με <code>?admin=1</code> στο τέλος του URL.<br><br>
            Παράδειγμα:<br>
            <code>https://fixmyathens.vercel.app/?admin=1</code><br><br>
            Θα εμφανιστεί κουμπί "Λήψη Leads (CSV)" για να κατεβάσεις όλα τα leads.
          </div>
        </div>

      </div>
    </div>

    <footer>
      FixMyAthens © 2025 · Athens<br>
      <div style="margin-top:6px;color:var(--dim);font-size:0.7rem;line-height:1.4;">
        Με τη χρήση της υπηρεσίας συμφωνείς ότι τα στοιχεία σου θα σταλούν
        στον τεχνικό για επικοινωνία σχετικά με το αίτημα.
      </div>
    </footer>

  </div>

  <!-- ====================== LOGIC ====================== -->
  <script>
  // ---------- ΡΥΘΜΙΣΕΙΣ ----------
  const SERVICES = [
    { label:"Υδραυλικός",        icon:"🚰" },
    { label:"Ηλεκτρολόγος",      icon:"💡" },
    { label:"Κλειδαράς",         icon:"🔑" },
    { label:"Ψυκτικός (A/C)",    icon:"❄️" },
    { label:"Γενικός μάστορας",  icon:"🛠️" },
    { label:"Άλλο",              icon:"🔧" }
  ];

  // ---------- ΜΑΣΤΟΡΕΣ ----------
  // ΕΣΥ ΘΑ ΤΟΥΣ ΠΡΟΣΘΕΣΕΙΣ ΕΔΩ. Αρχικά άδειο, όπως ζήτησες.
  const MASTORES = [
    // Παράδειγμα format (ΜΗΝ το αφήσεις όταν πας live με ξένα στοιχεία):
    // {
    //   id: "m001",
    //   name: "Όνομα Μάστορα",
    //   type: "Υδραυλικός",
    //   areas: ["Παγκράτι","Νέα Σμύρνη"],
    //   phone: "6900000000",
    //   whatsapp: "6900000000",
    //   availability: "Σήμερα"
    // }
  ];

  // ---------- DOM refs ----------
  const homeCard = document.getElementById('homeCard');
  const formCard = document.getElementById('formCard');
  const resultsCard = document.getElementById('resultsCard');
  const successCard = document.getElementById('successCard');

  const serviceGrid = document.getElementById('serviceGrid');
  const toFormBtn = document.getElementById('toFormBtn');

  const serviceSelect = document.getElementById('serviceSelect');
  const areaInput = document.getElementById('areaInput');
  const descInput = document.getElementById('descInput');
  const urgencySelect = document.getElementById('urgencySelect');
  const phoneInput = document.getElementById('phoneInput');

  const findBtn = document.getElementById('findBtn');
  const backHomeBtn = document.getElementById('backHomeBtn');
  const backToFormBtn = document.getElementById('backToFormBtn');
  const homeFromSuccess = document.getElementById('homeFromSuccess');

  const mastersList = document.getElementById('mastersList');
  const noMasters = document.getElementById('noMasters');

  const adminBar = document.getElementById('adminBar');
  const exportCsvBtn = document.getElementById('exportCsvBtn');

  // ---------- INIT UI ----------
  function initUI(){
    // 1. Γέμισε υπηρεσίες (Home grid)
    SERVICES.forEach(s=>{
      const el = document.createElement('div');
      el.className='choice';
      el.innerHTML = `
        <div class="choiceIcon">${s.icon}</div>
        <div style="font-weight:700;font-size:0.95rem;">${s.label}</div>
        <div class="meta" style="margin-top:6px;font-size:0.8rem;">
          Επίλεξε & συνέχισε
        </div>`;
      el.onclick = ()=>{
        serviceSelect.value = s.label;
        goToForm();
      };
      serviceGrid.appendChild(el);
    });

    // 2. Γέμισε select στη φόρμα
    SERVICES.forEach(s=>{
      const o = document.createElement('option');
      o.value = s.label;
      o.textContent = s.label;
      serviceSelect.appendChild(o);
    });

    // 3. Κουμπιά ροής
    toFormBtn.onclick = goToForm;
    backHomeBtn.onclick = goHomeFromForm;
    backToFormBtn.onclick = ()=>{ resultsCard.classList.add('hidden'); formCard.classList.remove('hidden'); };
    homeFromSuccess.onclick = ()=>{ successCard.classList.add('hidden'); homeCard.classList.remove('hidden'); };

    findBtn.onclick = onFind;

    // 4. Admin mode (leads CSV)
    const params = new URLSearchParams(location.search);
    if(params.get('admin')==='1'){
      adminBar.classList.remove('hidden');
    }
    exportCsvBtn.onclick = exportLeadsCsv;
  }

  function goToForm(){
    homeCard.classList.add('hidden');
    resultsCard.classList.add('hidden');
    successCard.classList.add('hidden');
    formCard.classList.remove('hidden');
  }

  function goHomeFromForm(){
    formCard.classList.add('hidden');
    resultsCard.classList.add('hidden');
    successCard.classList.add('hidden');
    homeCard.classList.remove('hidden');
  }

  // ---------- FIND MASTERS ----------
  function onFind(e){
    e.preventDefault?.();

    const service = serviceSelect.value.trim();
    const area = areaInput.value.trim();
    const desc = descInput.value.trim();
    const urgency = urgencySelect.value.trim();
    const phone = phoneInput.value.trim();

    if(!service || !area || !desc || !phone){
      alert("Συμπλήρωσε όλα τα πεδία.");
      return;
    }

    const matches = MASTORES.filter(m=>{
      const typeOk = (
        m.type === service ||
        (service==="Άλλο" && m.type==="Γενικός μάστορας")
      );
      const areaOk = m.areas.some(a => a.trim().toLowerCase() === area.toLowerCase());
      return typeOk && areaOk;
    });

    renderMasters(matches, {service,area,desc,urgency,phone});
  }

  // ---------- RENDER RESULTS ----------
  function renderMasters(list, requestData){
    formCard.classList.add('hidden');
    resultsCard.classList.remove('hidden');
    mastersList.innerHTML = '';

    if(!list.length){
      noMasters.classList.remove('hidden');
      return;
    }
    noMasters.classList.add('hidden');

    list.forEach(m => {
      const row = document.createElement('div');
      row.className = 'list-item';

      const left = document.createElement('div');
      left.innerHTML = `
        <div style="font-weight:700;font-size:0.95rem;">${m.name}</div>
        <div class="meta">${m.type} · ${m.availability || "Διαθεσιμότητα;"}</div>
        <div class="meta" style="margin-top:6px;font-size:0.75rem;">
          Καλύπτει: ${m.areas.join(', ')}
        </div>
      `;

      const right = document.createElement('div');
      right.className='actions';

      const callBtn = document.createElement('button');
      callBtn.className='small call';
      callBtn.textContent='ΚΑΛΕΣΕ';
      callBtn.onclick = () => {
        recordLead(m, requestData, 'call');
        window.location.href = `tel:${m.phone}`;
      };

      const waBtn = document.createElement('button');
      waBtn.className='small wa';
      waBtn.textContent='WHATSAPP';
      waBtn.onclick = () => {
        recordLead(m, requestData, 'whatsapp');
        const msg =
`Γεια σου, σε βρήκα από το FixMyAthens.
Έχω το εξής θέμα: ${requestData.desc}
Περιοχή: ${requestData.area}
Τηλ: ${requestData.phone}`;
        const encoded = encodeURIComponent(msg);
        window.open(
          `https://wa.me/30${m.whatsapp}?text=${encoded}`,
          '_blank'
        );
      };

      right.appendChild(callBtn);
      right.appendChild(waBtn);

      row.appendChild(left);
      row.appendChild(right);

      mastersList.appendChild(row);
    });
  }

  // ---------- LEADS STORAGE (LOCAL) ----------
  function getLeads(){
    try{
      const raw = localStorage.getItem('fixmyathens_leads');
      return raw ? JSON.parse(raw) : [];
    }catch(e){
      return [];
    }
  }
  function saveLeads(arr){
    localStorage.setItem('fixmyathens_leads', JSON.stringify(arr));
  }
  function recordLead(master, request, channel){
    const leads = getLeads();
    const lead = {
      id: Date.now().toString(),
      timestamp: new Date().toISOString(),
      masterId: master.id || null,
      masterName: master.name || null,
      masterPhone: master.phone || null,
      channel,
      requestService: request.service,
      requestArea: request.area,
      requestDesc: request.desc,
      requestUrgency: request.urgency,
      requestPhone: request.phone
    };
    leads.push(lead);
    saveLeads(leads);

    resultsCard.classList.add('hidden');
    successCard.classList.remove('hidden');
  }

  // ---------- EXPORT CSV (ADMIN) ----------
  function exportLeadsCsv(){
    const leads = getLeads();
    if(!leads.length){
      alert("Δεν υπάρχουν leads.");
      return;
    }

    const headers = [
      "id","timestamp","masterId","masterName","masterPhone",
      "channel","requestService","requestArea","requestDesc",
      "requestUrgency","requestPhone"
    ];

    const rows = leads.map(l =>
      headers.map(h=> JSON.stringify(l[h] ?? "") ).join(',')
    );

    const csv = [headers.join(',')].concat(rows).join('\r\n');
    const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = `fixmyathens_leads_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.csv`;
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  // ---------- INIT + PWA REGISTER ----------
  initUI();

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
      .catch(err => console.log('SW registration failed', err));
  }
  </script>
</body>
</html>
